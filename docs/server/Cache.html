<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>9Cards</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="A launcher crafted for and by Android Power Users" /><meta name="author" content="47deg" /><meta name="og:image" content="/nine-cards-v2/img/poster.png" /><meta name="og:title" content="9Cards" /><meta name="og:site_name" content="9Cards" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="A launcher crafted for and by Android Power Users" /><meta name="twitter:image" content="/nine-cards-v2/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/nine-cards-v2/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css" /><link rel="stylesheet" href="/nine-cards-v2/css/style.css" /><link rel="stylesheet" href="/nine-cards-v2/css/palette.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/nine-cards-v2/" class="brand"><div class="brand-wrapper" style="background:url('/nine-cards-v2/img/sidebar_brand.png') no-repeat"><span>9Cards</span></div></a></li> <li><a href="/nine-cards-v2/docs/index.html" class="">Introduction</a></li> <li><a href="/nine-cards-v2/docs/Libraries.html" class="">Libraries</a></li> <li><a href="/nine-cards-v2/docs/Client.html" class="">Client</a> <ul class="sub_section"> <li><a href="/nine-cards-v2/docs/client/Installation.html" class="">Installation</a></li> <li><a href="/nine-cards-v2/docs/client/Architecture.html" class="">Architecture</a></li> <li><a href="/nine-cards-v2/docs/client/Database.html" class="">Database</a></li> <li><a href="/nine-cards-v2/docs/client/CloudStorage.html" class="">Cloud Storage</a></li></ul></li> <li><a href="/nine-cards-v2/docs/Server.html" class="">Server</a> <ul class="sub_section"> <li><a href="/nine-cards-v2/docs/server/Installation.html" class="">Installation</a></li> <li><a href="/nine-cards-v2/docs/server/Architecture.html" class="">Architecture</a></li> <li><a href="/nine-cards-v2/docs/server/Ednpoints.html" class="">Ednpoints</a></li> <li><a href="/nine-cards-v2/docs/server/Authentication.html" class="">Authentication</a></li> <li><a href="/nine-cards-v2/docs/server/Cache.html" class="">Cache</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/47deg/nine-cards-v2"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/47deg/nine-cards-v2"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('9Cards A launcher crafted for and by Android Power Users');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('9Cards A launcher crafted for and by Android Power Users');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="47deg" data-github-repo="nine-cards-v2"><div class="content-wrapper"><section><h1 id="cache">Cache</h1>

<p>In order to reduce the number of request to Google Play API, we are storing the Google Play Info about the app in a intermediate cache using REDIS</p>

<p>##Redis cache management</p>

<p>Redis cache will contain only one key per package and could store four type of values depending on the result of getting info from Google Play:</p>
<ul>
  <li><code class="highlighter-rouge">resolved</code>: Those packages for which the process of getting Google Play info has been successfully completed will have this tag.</li>
  <li><code class="highlighter-rouge">pending</code>: If while the execution of a multi-package request, the Google Play API returns an error (<code class="highlighter-rouge">401 Unauthorized</code> or <code class="highlighter-rouge">429 Too many requests</code>), all the packages without info will be tag as pending. An internal process will try to get the info later.</li>
  <li><code class="highlighter-rouge">error</code>: If the request to get the Google Play information return a <code class="highlighter-rouge">404 Not Found</code> error, the package will be tagged as error.</li>
  <li><code class="highlighter-rouge">permanent</code>: All the packages with this tag are known applications that are not published in Google Play, but we can categorized them (for instance, the Samsung camera)</li>
</ul>

<p>The format of the key and value will be:</p>
<ul>
  <li><strong>Key:</strong> <code class="highlighter-rouge">"com.package.name:TYPE"</code></li>
  <li><strong>Value:</strong>
    <ul>
      <li>Example of a <code class="highlighter-rouge">resolved</code> item</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"packageName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.package.name"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Package title"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"free"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://lh3.googleusercontent.com/aYbdIM1abwyVSUZLDKoE0CDZGRhlkpsaPOg9tNnBktUQYsXflwknnOn2Ge1Yr7rImGk"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"stars"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"downloads"</span><span class="p">:</span><span class="w"> </span><span class="s2">"500,000,000 - 1,000,000,000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"SOCIAL"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"screenshoots"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"url1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"url2"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<ul>
  <li>Example of a <code class="highlighter-rouge">pending</code> item</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{}</span><span class="w">
</span></code></pre>
</div>
<ul>
  <li>Example of a <code class="highlighter-rouge">error</code> item with the dates when the errors were produced</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>[
    "date1",
    "date2"
] 
</code></pre>
</div>
<ul>
  <li>Example of a <code class="highlighter-rouge">permanent</code> item</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"packageName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.package.name"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"SOCIAL"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h2 id="workflow">Workflow</h2>

<p>The described workflow will be performed for each package of the list:</p>

<ol>
  <li>Check if exists a key in Redis for the package and the type of the value is <code class="highlighter-rouge">resolved</code> or <code class="highlighter-rouge">permanent</code>
    <ul>
      <li>If the key/value exists, the process will return the stored package info as resolved</li>
      <li>Otherwise the process will continue in step 2</li>
    </ul>
  </li>
  <li>Try to get the package info by using Google Play API
    <ul>
      <li>If the API returns a valid response:
        <ul>
          <li>A new item of type <code class="highlighter-rouge">resolved</code> will be created in Redis</li>
          <li>If a previous <code class="highlighter-rouge">error</code> or <code class="highlighter-rouge">pending</code> item exists, this key will be removed</li>
          <li>The process will return the package info as resolved</li>
          <li>If an error is thrown (like <code class="highlighter-rouge">401 Unauthorized</code> or <code class="highlighter-rouge">429 Too many requests</code>), the process will continue in step 3</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Check if the package exists in Google Play by requesting the server headers (faster and small size of the response)
    <ul>
      <li>If the package exists, the process will continue in step 4</li>
      <li>Otherwise the process will continue in step 5</li>
    </ul>
  </li>
  <li>Check if exists a key in Redis for the package and the type of the value is <code class="highlighter-rouge">pending</code> or <code class="highlighter-rouge">error</code>
    <ul>
      <li>If a value of type <code class="highlighter-rouge">pending</code> exists, the process will do nothing</li>
      <li>If a value of type <code class="highlighter-rouge">error</code> exists, the process will change the type of the item to <code class="highlighter-rouge">pending</code></li>
      <li>Otherwise a new item of type <code class="highlighter-rouge">pending</code> will be created in Redis</li>
      <li>In all the cases, the package will be return as <code class="highlighter-rouge">pending</code></li>
    </ul>
  </li>
  <li>Check if exists a key in Redis for the package and the type of the value is <code class="highlighter-rouge">error</code>
    <ul>
      <li>If the key exists, a new date will be appended to the value</li>
      <li>Otherwise a new item of type <code class="highlighter-rouge">error</code> will be created in Redis</li>
      <li>In all the cases, the package will be return as <code class="highlighter-rouge">error</code></li>
    </ul>
  </li>
</ol>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/languages/scala.min.js"></script><script src="/nine-cards-v2/js/main.js"></script></body></html>