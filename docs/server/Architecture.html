<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>9Cards</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="A launcher crafted for and by Android Power Users" /><meta name="author" content="47deg" /><meta name="og:image" content="/nine-cards-v2/img/poster.png" /><meta name="og:title" content="9Cards" /><meta name="og:site_name" content="9Cards" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="A launcher crafted for and by Android Power Users" /><meta name="twitter:image" content="/nine-cards-v2/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/nine-cards-v2/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/nine-cards-v2/highlight/styles/default.css" /><link rel="stylesheet" href="/nine-cards-v2/css/style.css" /><link rel="stylesheet" href="/nine-cards-v2/css/palette.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/nine-cards-v2/" class="brand"><div class="brand-wrapper" style="background:url('/nine-cards-v2/img/sidebar_brand.png') no-repeat"><span>9Cards</span></div></a></li> <li><a href="/nine-cards-v2/docs/index.html" class="">Introduction</a></li> <li><a href="/nine-cards-v2/docs/Libraries.html" class="">Libraries</a></li> <li><a href="/nine-cards-v2/docs/Client.html" class="">Client</a> <ul class="sub_section"> <li><a href="/nine-cards-v2/docs/client/Installation.html" class="">Install Client</a></li> <li><a href="/nine-cards-v2/docs/client/Architecture.html" class="">Client Architecture</a></li> <li><a href="/nine-cards-v2/docs/client/Database.html" class="">Database</a></li> <li><a href="/nine-cards-v2/docs/client/CloudStorage.html" class="">Cloud Storage</a></li></ul></li> <li><a href="/nine-cards-v2/docs/Server.html" class="">Server</a> <ul class="sub_section"> <li><a href="/nine-cards-v2/docs/server/Installation.html" class="">Install Server</a></li> <li><a href="/nine-cards-v2/docs/server/Architecture.html" class=" active ">Server Architecture</a></li> <li><a href="/nine-cards-v2/docs/server/Ednpoints.html" class="">Endpoints</a></li> <li><a href="/nine-cards-v2/docs/server/Authentication.html" class="">Authentication</a></li> <li><a href="/nine-cards-v2/docs/server/Cache.html" class="">Cache</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/47deg/nine-cards-v2"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/47deg/nine-cards-v2"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('9Cards A launcher crafted for and by Android Power Users');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('9Cards A launcher crafted for and by Android Power Users');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="47deg" data-github-repo="nine-cards-v2"><div class="content-wrapper"><section><h1 id="architecture">Architecture</h1>

<p>This file describes the architecture of the 9 Cards Backend.</p>

<h2 id="overview">Overview</h2>

<p>In this section, we will describe the environment of the application, and how it interacts with this environment.</p>

<h3 id="api">API</h3>

<p>The 9 Cards backend is a HTTP/REST application. Every operation is initiated by a call to an endpoint in the API. The backend has no other internal state changing operations.
Most of the endpoints in the API are assumed to receive messages from a 9 Cards client.
All the information sent from the backend to any client is sent in response to a client’s HTTP request.
The backend does not communicate directly with 9 Cards’ clients. For notifications, it uses
the <a href="http://firebase.google.com/docs/cloud-messaging/">Firebase Cloud Messaging</a> API.</p>

<h3 id="external-systems">External Systems</h3>

<p>The backend application interacts with several <strong>external</strong> systems and APIs outside of the application, for retrieving or storing information, or for sending notifications. The external systems are the following:</p>

<ul>
  <li><strong>Database</strong>. A <a href="http://www.postgresql.org/">PostgreSQL</a> database is used to store information that’s needed by the backend.
This includes information about 9 Cards’ clients (users and devices), shared collections, the user’s subscriptions of shared collections, and the information about countries.</li>
  <li><strong>Google API</strong>. The Google API is used upon a client’s signup, to check the identity of a new client.</li>
  <li><strong>Google Analytics</strong>. A Google Analytics report collects aggregated statistics about the applications used in 9 Cards, such as which applications are more frequently added or removed to a <em>moment</em>, or which applications are most frequently used within each category. This data doesn’t contain any information about the user with the exception of the country, as given by Google Analytics.
From this data, the backend builds the <em>rankings</em> of applications.</li>
  <li><strong>Android Market</strong>. The API of the Android Market is used to retrieve information about the Android applications in the Play store, and also for searching lists of new applications either by name, by their category, or by their similarity to apps that are already installed.</li>
  <li><strong>Play Store Web</strong>. Sometimes, the information about an app is not available in the Market API; instead, we retrieve it from each app’s page in the <a href="http://play.google.com/store/">Play Store website</a>.</li>
  <li><strong>Redis</strong>. We use a <a href="http://redis.io/">Redis</a> in-memory store as a <em>cache</em> to keep non-original data; that is to say, data that is retrieved from a remote source, or computed from a remote source. This includes the data about each application fetched from the Android Market API, and the most-valued application rankings computed from the Google Analytics Report.</li>
  <li><strong>Firebase</strong>. The <a href="http://firebase.google.com/docs/cloud-messaging/">Firebase Cloud Messaging</a> API is used to notify the subscribers of any changes to the list of apps in a shared collection.</li>
</ul>

<h3 id="core-modules">Core Modules</h3>

<p>The backend source code is organized into four modules, or <code class="highlighter-rouge">sbt</code> projects, called <code class="highlighter-rouge">api</code>, <code class="highlighter-rouge">processes</code>, <code class="highlighter-rouge">services</code>, <code class="highlighter-rouge">googleplay</code>, and <code class="highlighter-rouge">commons</code>.</p>

<ul>
  <li>The <a href="/modules/commons"><code class="highlighter-rouge">commons</code></a> module contains the definition of the backend’s <code class="highlighter-rouge">domain</code> classes,
and utility methods for common libraries, such as <code class="highlighter-rouge">cats</code> or <code class="highlighter-rouge">scalaz</code>. It also handles the environment configuration variables needed for each service interpreter.</li>
  <li>The <a href="/modules/api"><code class="highlighter-rouge">api</code></a> module implements the <code class="highlighter-rouge">REST-HTTP</code> application’s API, and the application’s
main method. It uses the libraries <code class="highlighter-rouge">spray</code>, and <code class="highlighter-rouge">spray-json</code> (with a bit of <code class="highlighter-rouge">circe</code>).</li>
  <li>The <a href="/modules/processes"><code class="highlighter-rouge">processes</code></a> module contains the application’s process methods. Each process method implements the functionality of one endpoint, using one or more services. The implementation follows a functional programming style, based on the use of monadic operations.</li>
  <li>The <a href="/modules/services"><code class="highlighter-rouge">services</code></a> module implements the backend’s services; each services retrieves and
communicates data with an external system. The services layer is based on the <code class="highlighter-rouge">doobie</code> and <code class="highlighter-rouge">http4s</code> libraries.</li>
  <li>The <a href="/modules/googleplay"><code class="highlighter-rouge">googleplay</code></a> implements a subset of services, originally developed as a separate
module that interacts with the Android Market API, and which uses the Redis cache for internal storage.</li>
</ul>

<p>The <code class="highlighter-rouge">commons</code> module is available to all other modules. The dependencies among other modules are as follows:
the <code class="highlighter-rouge">api</code> only depends on <code class="highlighter-rouge">processes</code>; the <code class="highlighter-rouge">processes</code> only depends on <code class="highlighter-rouge">services</code>, and <code class="highlighter-rouge">services</code> depends
on <code class="highlighter-rouge">googleplay</code>.</p>

<h2 id="functional-programming-design">Functional Programming Design</h2>

<p>This section describes the Functional Programming design followed in writing the processes and services for the backend. This design is inspired by the <a href="http://dblp.org/rec/html/journals/jfp/Swierstra08">Data Types à la carte</a> paper. The key elements of this design are <em>1)</em> a separation between a service’s algebra of operations and
its interpreter, and <em>2)</em> the use of the <code class="highlighter-rouge">Free</code> monad for combining operations of different algebras.</p>

<h3 id="services-algebra-and-interpreter">Services: Algebra and Interpreter</h3>

<p>Each service in the <code class="highlighter-rouge">services</code> layer declares an algebra of operations, and an interpreter of those operations.</p>

<p>The <strong>algebra</strong> defines an abstract data type <code class="highlighter-rouge">Ops[A]</code>, which represents the operations that can be done in that service.
Each operation can be seen as a <a href="http://en.wikipedia.org/wiki/Command_pattern">command</a> object,
which carries the input parameters needed to specify the value of the result.
As a guideline, each operation in an algebra should be atomic and involve at the most, one interaction
with the external system in question.</p>

<p>The <strong>interpreter</strong> is the part of the service that takes the operations of the algebra and computes the results of that operation.
An <code class="highlighter-rouge">Interpreter</code> is a (class of) object that implements a function from the service’s algebra ADT
<code class="highlighter-rouge">Ops[A]</code> to another parametric type, <code class="highlighter-rouge">F[A]</code>, with the same base type <code class="highlighter-rouge">A</code>.
Operations that transform from one parametric type <code class="highlighter-rouge">F[A]</code> to another parametric type <code class="highlighter-rouge">G[A]</code> are called <em>natural transformations</em>;
and in the backend, every service interpreters must be a subtype of <a href="http://github.com/typelevel/cats/blob/master/core/src/main/scala/cats/arrow/FunctionK.scala"><code class="highlighter-rouge">cats.arrow.FunctionK</code></a>.</p>

<p>The target type <code class="highlighter-rouge">F</code> of the interpretation represents the kind of computation involved to obtain that result.
It can be <a href="http://github.com/scalaz/scalaz/blob/series/7.3.x/concurrent/src/main/scala/scalaz/concurrent/Task.scala"><code class="highlighter-rouge">Task</code></a>,
to represent an asynchronous computation of the result,
or <a href="http://github.com/tpolecat/doobie/blob/master/core/src/main/scala/doobie/free/connection.scala"><code class="highlighter-rouge">ConnectionIO</code></a>,
to represent a computation that performs queries with <code class="highlighter-rouge">doobie</code>,
or just <code class="highlighter-rouge">Id</code>, to represent a result obtained just within the application (for testing).</p>

<h4 id="processes-free-monad-and-coproducts">Processes: Free Monad and Coproducts</h4>

<p>Each process in the processes layer implements the functionality of one endpoint, and it usually involves
using different services.
For instance, the process to retrieve the details of a shared collection involves reading the collection information
out of the database and then retrieving from the Android Market API (or from the cache) the data of each
application in that collection. However, each service defines its operation in a separate algebra,
such as <code class="highlighter-rouge">OpsDB[A]</code> or <code class="highlighter-rouge">OpsRK[B]</code>.</p>

<p>To combine operations from several services, each operation of each algebra is <em>injected</em> into a <code class="highlighter-rouge">Free</code> monad
<code class="highlighter-rouge">Free[F,A]</code>. If the <code class="highlighter-rouge">F</code> type parameter is the same, then the
<a href="http://github.com/typelevel/cats/blob/master/free/src/main/scala/cats/free/Free.scala"><code class="highlighter-rouge">Free</code></a> datatype provides
the operations for passing the results between the operations from different algebras.</p>

<p>This is achieved by using as that <code class="highlighter-rouge">F</code>, a <code class="highlighter-rouge">Coproduct</code> of the different algebras operation types <code class="highlighter-rouge">Ops[A]</code>.
The interpretation of the <code class="highlighter-rouge">Coproduct</code> operations, then, becomes an alternative between them.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/nine-cards-v2/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/nine-cards-v2/js/main.js"></script></body></html>